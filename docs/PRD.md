# PRD: 모이자 (Moija)

> 역설계(Reverse Engineering) 기반 PRD - 구현된 코드를 분석하여 작성
> 작성일: 2026-02-20

---

## 1. 프로젝트 개요

### 목적

카카오톡 단체 채팅방 대신 사용할 수 있는 모임 공지 및 참여 관리 도구.
주최자는 링크 하나를 공유하는 것만으로 모임 공지, 참여 신청 수집, 출석 체크를 처리할 수 있다.

### 배경 및 핵심 가치

수영, 헬스, 친목 모임 등 정기/비정기 소모임을 운영하는 주최자는 매번 채팅방에 공지를 올리고, 참여 여부를 수동으로 취합하고, 당일 출석을 따로 체크해야 한다. 모이자는 이 세 가지 흐름을 하나의 링크로 통합한다.

핵심 차별점은 **비회원 참여 신청**이다. 참여자는 별도 회원가입 없이 이름만 입력해 신청할 수 있어 링크 공유만으로 즉시 참여 수집이 가능하다.

### 현재 구현 상태

MVP 완성 단계. 모임 생성·수정·삭제, 공개 참여 신청(비회원 포함), 참여자 상태 관리, 출석 체크, 링크 공유 기능이 모두 동작한다.

---

## 2. 사용자 스토리

### 주최자 (회원)

- 주최자로서, 모임 정보(제목·날짜·장소·참가비·인원 제한)를 입력해 공유 링크를 즉시 생성하고 싶다.
- 주최자로서, 내가 만든 모임 목록을 한 화면에서 확인하고 싶다.
- 주최자로서, 참여 신청자 목록을 보고 각 참여자를 확정·취소 처리하고 싶다.
- 주최자로서, 모임 당일 참여자 이름 옆 체크박스를 눌러 출석을 간편하게 처리하고 싶다.
- 주최자로서, 모집이 끝나면 모임 상태를 "마감" 또는 "완료"로 변경하고 싶다.
- 주최자로서, 실수로 만든 모임을 삭제하기 전에 확인 다이얼로그를 거치고 싶다.

### 참여자 (비회원 포함)

- 참여자로서, 링크를 열어 모임 날짜·장소·참가비를 확인하고 싶다.
- 참여자로서, 회원가입 없이 이름(필수)과 연락처(선택)·메모(선택)만 입력해 참여 신청하고 싶다.
- 참여자로서, 정원이 마감된 모임에 신청이 불가함을 즉시 알고 싶다.

### 회원 참여자

- 회원으로서, 공개 모임 페이지에서 내 프로필 이름이 자동으로 채워진 상태로 신청하고 싶다.
- 회원으로서, 같은 모임에 중복 신청이 차단되기를 바란다.

---

## 3. 기능 요구사항

### 3-1. 인증

| 기능                         | 설명                                                                |
| ---------------------------- | ------------------------------------------------------------------- |
| 이메일·비밀번호 회원가입     | 이메일 인증 메일 발송 후 `/auth/sign-up-success` 안내 페이지로 이동 |
| 이메일·비밀번호 로그인       | 로그인 성공 시 `/protected`로 리다이렉트                            |
| Google OAuth 로그인/회원가입 | OAuth 콜백(`/auth/callback`) 처리 후 `/protected`로 이동            |
| 비밀번호 재설정              | 이메일로 재설정 링크 발송, 링크 클릭 시 `/auth/update-password`     |
| 로그아웃                     | 세션 종료 후 홈으로 이동                                            |
| 미인증 접근 차단             | `/protected/*` 경로 접근 시 미들웨어가 `/auth/login`으로 리다이렉트 |

### 3-2. 모임 관리 (주최자 전용)

| 기능           | 설명                                                                                                            |
| -------------- | --------------------------------------------------------------------------------------------------------------- |
| 모임 생성      | 제목(필수)·설명·날짜·장소·지도 링크·최대 인원·참가비를 입력하면 8자리 nanoid 슬러그가 자동 생성됨               |
| 모임 목록 조회 | 로그인 사용자가 생성한 모임 목록을 날짜 역순 카드 그리드로 표시. 각 카드에 날짜·장소·참가비·참여자 수 요약 표시 |
| 모임 상세 조회 | 개요 탭(날짜·장소·참가비·설명·공유 링크)과 참여자 탭(참여자 테이블) 두 탭으로 구성                              |
| 모임 수정      | 기존 정보를 폼에 채워서 수정. 호스트 본인만 접근 가능                                                           |
| 모임 삭제      | 확인 다이얼로그 후 삭제. 연결된 참여자 데이터도 함께 삭제됨. 호스트 본인만 가능                                 |
| 모임 상태 변경 | `draft` / `open` / `closed` / `completed` 4가지 상태 관리                                                       |
| 공유 링크 복사 | 클립보드에 `/events/{slug}` 형식 URL 복사. 복사 후 2초간 "복사됨" 피드백 표시                                   |

### 3-3. 참여자 관리 (주최자 전용)

| 기능             | 설명                                                                                                         |
| ---------------- | ------------------------------------------------------------------------------------------------------------ |
| 참여자 목록 조회 | 이름·연락처·상태(대기/확정/취소)·신청일 테이블 형식으로 표시                                                 |
| 참여자 상태 변경 | 개별 참여자를 "확정" 또는 "취소" 처리                                                                        |
| 출석 체크        | 별도 출석 체크 화면에서 확정된 참여자 목록을 체크박스 방식으로 처리. 출석 현황(n/전체 명)을 상단에 요약 표시 |

### 3-4. 모임 참여 신청 (공개, 비회원 포함)

| 기능                         | 설명                                                                                              |
| ---------------------------- | ------------------------------------------------------------------------------------------------- |
| 공개 모임 페이지             | 슬러그 기반 공개 URL(`/events/{slug}`)로 누구나 접근 가능. 모임 정보 표시                         |
| 참여 신청                    | 이름(필수)·연락처(선택)·메모(선택) 입력 후 신청. 신청 즉시 상태가 `confirmed`로 저장됨            |
| 로그인 사용자 이름 자동 입력 | 회원이 공개 페이지에 접근하면 프로필 `full_name`이 이름 필드에 자동 입력되고 읽기 전용으로 설정됨 |
| 중복 신청 차단               | 동일 이벤트에 같은 `user_id`로 중복 신청 시 오류 반환 (로그인 사용자만 적용)                      |
| 정원 초과 시 신청 불가       | `max_participants` 초과 또는 상태가 `open`이 아닌 경우 신청 폼 비표시                             |
| 주최자 관리 링크 노출        | 공개 페이지에서 주최자 본인이 접근하면 "관리" 버튼 표시                                           |

### 3-5. 프로필 관리

| 기능                | 설명                                                                          |
| ------------------- | ----------------------------------------------------------------------------- |
| 프로필 조회 및 수정 | 사용자명(3~30자, 영문·숫자·밑줄)·실명·웹사이트·자기소개(최대 500자) 수정 가능 |
| 이메일 표시         | 수정 불가. 인증 시스템에서 관리되므로 읽기 전용으로만 표시                    |

---

## 4. 비기능 요구사항

### 기술 스택

| 분류          | 기술                                     |
| ------------- | ---------------------------------------- |
| 프레임워크    | Next.js 15 (App Router)                  |
| 언어          | TypeScript 5                             |
| UI 라이브러리 | React 19                                 |
| 스타일링      | TailwindCSS 3, shadcn/ui (Radix UI 기반) |
| 폼 관리       | React Hook Form 7 + Zod 4                |
| 백엔드/DB     | Supabase (PostgreSQL, Auth, RLS)         |
| 아이콘        | Lucide React                             |
| 날짜 처리     | date-fns 4 (한국어 로케일)               |
| 슬러그 생성   | nanoid 5                                 |
| 테마          | next-themes (다크/라이트 전환)           |
| 배포          | Vercel (예정)                            |

### 코드 품질 도구

| 도구                                   | 용도               |
| -------------------------------------- | ------------------ |
| ESLint + eslint-config-next            | 린팅               |
| Prettier + prettier-plugin-tailwindcss | 코드 포맷팅        |
| Husky + lint-staged                    | pre-commit 훅      |
| commitlint                             | 커밋 메시지 컨벤션 |

### 보안

- 모든 `public.*` 테이블에 Row Level Security(RLS) 활성화
- `/protected/*` 경로는 미들웨어(`proxy.ts`)에서 세션 검증 후 미인증 시 로그인 페이지로 리다이렉트
- 모임 수정·삭제·참여자 관리 서버 액션에서 `host_id === 현재 사용자 ID` 검증
- Supabase `getClaims()`를 사용하여 서버 측 인증 확인 (getUser()보다 빠른 JWT 기반 클레임 검증)

### 성능

- 모든 페이지 컴포넌트는 기본적으로 Server Component로 구현하여 초기 로드 성능 확보
- `'use client'`는 상태·이벤트 핸들러가 필요한 최소 컴포넌트(폼, 버튼 등)에만 적용
- 데이터 변경 후 `revalidatePath()`로 캐시 무효화

---

## 5. 데이터 모델

### profiles (사용자 프로필)

Supabase `auth.users`와 1:1 연결. 회원가입 시 트리거로 자동 생성.

| 필드       | 타입        | 설명                               |
| ---------- | ----------- | ---------------------------------- |
| id         | UUID        | auth.users.id와 동일 (PK, FK)      |
| username   | text        | 사용자명, 3~30자, unique, nullable |
| full_name  | text        | 실명, nullable                     |
| avatar_url | text        | 아바타 이미지 URL, nullable        |
| website    | text        | 웹사이트 URL, nullable             |
| bio        | text        | 자기소개, 최대 500자, nullable     |
| created_at | timestamptz | 생성 시각                          |
| updated_at | timestamptz | 수정 시각                          |

### events (모임)

| 필드             | 타입        | 설명                                                     |
| ---------------- | ----------- | -------------------------------------------------------- |
| id               | UUID        | PK, gen_random_uuid()                                    |
| host_id          | UUID        | 주최자 ID (FK → profiles.id)                             |
| title            | text        | 모임 제목 (필수)                                         |
| description      | text        | 모임 설명, nullable                                      |
| event_date       | timestamptz | 모임 일시 (필수)                                         |
| location         | text        | 장소 이름 (필수)                                         |
| location_url     | text        | 지도 링크(카카오맵/구글맵), nullable                     |
| max_participants | integer     | 최대 참여 인원, nullable (제한 없음)                     |
| fee              | integer     | 참가비(원), 기본값 0                                     |
| slug             | text        | 공유 링크용 8자리 nanoid, unique                         |
| status           | text        | `draft` / `open` / `closed` / `completed`, 기본값 `open` |
| created_at       | timestamptz | 생성 시각                                                |
| updated_at       | timestamptz | 수정 시각                                                |

### event_participants (참여자)

| 필드        | 타입        | 설명                                                      |
| ----------- | ----------- | --------------------------------------------------------- |
| id          | UUID        | PK, gen_random_uuid()                                     |
| event_id    | UUID        | FK → events.id                                            |
| user_id     | UUID        | FK → profiles.id, nullable (비회원은 null)                |
| guest_name  | text        | 참여자 이름                                               |
| guest_phone | text        | 참여자 연락처, nullable                                   |
| note        | text        | 메모, nullable                                            |
| status      | text        | `pending` / `confirmed` / `cancelled`, 기본값 `confirmed` |
| attended    | boolean     | 출석 여부, 기본값 false                                   |
| created_at  | timestamptz | 신청 시각                                                 |

### instruments (예시 테이블)

스타터킷 예시용 테이블. 실제 서비스 기능과 무관.

| 필드 | 타입   | 설명         |
| ---- | ------ | ------------ |
| id   | bigint | PK, identity |
| name | text   | 악기 이름    |

---

## 6. 화면 구성

### 공개 영역 (인증 불필요)

| 경로                    | 페이지명         | 설명                                                                    |
| ----------------------- | ---------------- | ----------------------------------------------------------------------- |
| `/`                     | 홈(랜딩)         | 서비스 소개, 히어로 섹션, 핵심 기능 3가지 카드, 시작하기/로그인 버튼    |
| `/events/[slug]`        | 모임 공개 페이지 | 모임 정보 표시 + 참여 신청 폼. 슬러그 기반 URL로 누구나 접근 가능       |
| `/auth/login`           | 로그인           | 이메일/비밀번호 로그인, Google OAuth, 회원가입 링크, 비밀번호 찾기 링크 |
| `/auth/sign-up`         | 회원가입         | 이메일/비밀번호 가입, Google OAuth, 비밀번호 확인                       |
| `/auth/sign-up-success` | 회원가입 완료    | 이메일 인증 메일 발송 안내                                              |
| `/auth/forgot-password` | 비밀번호 찾기    | 이메일 입력 후 재설정 링크 발송                                         |
| `/auth/update-password` | 비밀번호 재설정  | 새 비밀번호 입력                                                        |
| `/auth/confirm`         | 이메일 인증 처리 | OTP 확인 후 리다이렉트 (라우트 핸들러)                                  |
| `/auth/callback`        | OAuth 콜백       | Google OAuth 처리 (라우트 핸들러)                                       |
| `/auth/error`           | 인증 오류        | 인증 관련 오류 안내                                                     |

### 인증 필요 영역 (`/protected/*`)

공통 레이아웃: 상단 내비게이션("모이자" 로고 + "내 모임" 링크 + 인증 버튼 + 다크/라이트 테마 전환)과 하단 푸터.

| 경로                                | 페이지명       | 설명                                                                  |
| ----------------------------------- | -------------- | --------------------------------------------------------------------- |
| `/protected`                        | 보호 영역 홈   | 로그인된 사용자 정보(JWT 클레임) 표시. 스타터킷 개발 가이드 링크 포함 |
| `/protected/events`                 | 내 모임 목록   | 내가 만든 모임 카드 그리드. "새 모임 만들기" 버튼                     |
| `/protected/events/new`             | 새 모임 만들기 | 모임 생성 폼                                                          |
| `/protected/events/[id]`            | 모임 관리      | 개요 탭 + 참여자 탭. 수정/삭제/출석체크/공유 링크 복사                |
| `/protected/events/[id]/edit`       | 모임 수정      | 기존 정보 편집 폼                                                     |
| `/protected/events/[id]/attendance` | 출석 체크      | 확정된 참여자 체크박스 목록. 출석 현황 요약 표시                      |
| `/protected/profile`                | 프로필 설정    | 사용자명·실명·웹사이트·자기소개 수정                                  |

### 공개 예시 페이지

| 경로           | 설명                                                            |
| -------------- | --------------------------------------------------------------- |
| `/instruments` | Supabase 데이터 조회 예시 (스타터킷 튜토리얼용, 서비스 외 기능) |

---

## 7. 기술 제약사항 및 아키텍처 결정

### Server Component 우선 원칙

모든 컴포넌트는 기본적으로 Server Component. `'use client'`는 다음 경우에만 적용한다.

- 폼 컴포넌트 (EventForm, JoinForm, LoginForm, SignUpForm, ProfileForm 등)
- 상태나 이벤트 핸들러가 필요한 버튼 (DeleteEventButton, ShareButton, AttendanceList, ParticipantTable 등)

### Supabase 클라이언트 분리

- **서버 컴포넌트 / 서버 액션 / 라우트 핸들러**: `lib/supabase/server.ts`의 `createClient()` (async, 매 호출마다 새 인스턴스 생성)
- **클라이언트 컴포넌트**: `lib/supabase/client.ts`의 `createClient()`

서버 클라이언트를 전역 변수에 저장하지 않는 것은 Vercel Fluid Compute 환경 호환성을 위한 결정이다.

### 인증 세션 관리

`supabase.auth.getClaims()`를 사용하여 JWT 클레임에서 사용자 정보를 추출한다. `getUser()`는 매 요청마다 Supabase Auth 서버에 네트워크 요청을 보내지만, `getClaims()`는 로컬 JWT 파싱만 수행하므로 빠르다.

세션 갱신은 `proxy.ts` → `lib/supabase/proxy.ts` 미들웨어에서 모든 요청마다 처리한다.

### Next.js 15 비동기 API

`params`, `searchParams`, `cookies()`, `headers()`는 모두 비동기로 처리한다.

```tsx
// 올바른 방식
export default async function Page({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params
}
```

### Server Actions 패턴

데이터 변경 작업은 `/app/actions/` 디렉토리의 Server Actions를 통해 처리한다.

- `events.ts`: 모임 CRUD + 상태 변경
- `participants.ts`: 참여 신청, 참여자 상태 변경, 출석 체크

각 액션은 Zod 스키마로 입력값을 검증하고, 에러 발생 시 `{ error: ... }` 형태로 반환한다.
성공 시 `revalidatePath()`로 관련 캐시를 무효화하고 `redirect()`로 이동한다.

### 파일 네이밍 컨벤션

- 파일명: `kebab-case.tsx`
- 컴포넌트명: `PascalCase`
- 폴더명: `kebab-case`
- import: `@/` 경로 별칭 사용 (상대경로 금지)

### Export 규칙

- 일반 컴포넌트: Named export (`export function Foo() {}`)
- 페이지 컴포넌트: Default export (`export default function Page() {}`)
